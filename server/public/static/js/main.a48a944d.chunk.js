(this["webpackJsonpredux-paint"]=this["webpackJsonpredux-paint"]||[]).push([[0],{26:function(e,t,n){e.exports={container:"app_container__2JKVN"}},27:function(e,t,n){e.exports={body:"windowBody_body__1e9lm"}},30:function(e,t,n){},38:function(e,t,n){},39:function(e,t,n){},45:function(e,t,n){},47:function(e,t,n){},48:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n.n(r),a=n(17),i=n.n(a),o=(n(38),n(11)),s=n.n(o),u=n(26),l=n.n(u),d=n(6),j=n(27),f=n.n(j),b=(n(39),n(3)),O=n(4),p=Object(O.b)("endStroke"),x=Object(O.b)("reset"),h=Object(O.b)("setStrokes"),v={points:[],color:"#000"},m=Object(O.d)({name:"currentStroke",initialState:v,reducers:{startStroke:function(e,t){e.points.push(t.payload)},updateStroke:function(e,t){e.points.push(t.payload)},setColor:function(e,t){e.color=t.payload}},extraReducers:function(e){e.addCase(p,(function(e){e.points=[]})),e.addCase(x,(function(){return v}))}}),g=m.actions,y=g.startStroke,w=g.updateStroke,N=g.setColor,k=m.reducer,C=n(54),S="COLOR_PANEL",E="EDIT_PANEL",D="FILE_PANEL",R=function(e){return e.currentStroke},L=function(e){return e.historyIndex},M=function(e){return e.strokes},P=function(e){return e.modalVisible},_=function(e){return e.projects},A=n(1),I=["#000","#264653","#2a9d8f","#e9c46a","#f4a261","#e76f51","#fff"];function T(e){var t=e.left,n=e.top,r=Object(b.c)(R),c=Object(b.b)(),a=Object(C.a)((function(){return{type:S,item:{type:S,top:n,left:t},collect:function(e){return{isDragging:e.isDragging()}}}}),[n,t]),i=Object(d.a)(a,2),o=i[0].isDragging,u=i[1];return o?Object(A.jsx)("div",{ref:u}):Object(A.jsxs)("div",{className:"window colors-panel",ref:u,style:{top:n+"px",left:t+"px"},children:[Object(A.jsx)("div",{className:"title-bar",children:Object(A.jsx)("div",{className:"title-bar-text",children:"Colors"})}),Object(A.jsx)("div",{className:"window-body color-container",children:I.map((function(e){return Object(A.jsx)("div",{onClick:function(){!function(e){c(N(e))}(e)},className:s()("color",{active:e===r.color}),style:{backgroundColor:e}},e)}))})]})}n(45);var J=Object(O.d)({name:"historyIndex",initialState:0,reducers:{undo:function(e,t){return Math.min(e+1,t.payload)},redo:function(e){return Math.max(e-1,0)}},extraReducers:function(e){e.addCase(p,(function(e){return 0})),e.addCase(x,(function(){return 0})),e.addCase(h,(function(){return 0}))}}),F=J.actions,V=F.undo,U=F.redo,B=J.reducer,q=function(e){var t=e.top,n=e.left,r=Object(b.c)(M),c=Object(b.b)(),a=Object(C.a)((function(){return{type:E,item:{type:E,top:t,left:n},collect:function(e){return{isDragging:e.isDragging()}}}}),[t,n]),i=Object(d.a)(a,2),o=i[0].isDragging,s=i[1];return o?Object(A.jsx)("div",{ref:s}):Object(A.jsxs)("div",{className:"window edit-panel",ref:s,style:{top:t+"px",left:n+"px"},children:[Object(A.jsx)("div",{className:"title-bar",children:Object(A.jsx)("div",{className:"title-bar-text",children:"Edit"})}),Object(A.jsx)("div",{className:"window-body",children:Object(A.jsxs)("div",{className:"field-row",children:[Object(A.jsx)("button",{className:"button redo",onClick:function(){return c(V(r.length))},children:"Undo"}),Object(A.jsx)("button",{className:"button undo",onClick:function(){return c(U())},children:"Redo"}),Object(A.jsx)("button",{className:"button clear",onClick:function(){return c(x())},children:"Clear"})]})})]})},z=n(9),W=n.n(z),X=n(10),Y=(n(47),n(29)),K=function(e,t,n){t.length&&(e.strokeStyle=n,e.beginPath(),e.moveTo(t[0].x,t[0].y),t.forEach((function(t){e.lineTo(t.x,t.y),e.stroke()})),e.closePath())},G=function(e,t){t.fillStyle="#fff",t.fillRect(0,0,e.width,e.height)},H=function(){var e=Object(X.a)(W.a.mark((function e(t){return W.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){if(!t)return n(null);t.toBlob(e)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Q=Object(r.createContext)({}),Z=function(e){var t=e.children,n=Object(r.useRef)(null);return Object(A.jsx)(Q.Provider,{value:n,children:t})},$=function(){return Object(r.useContext)(Q)},ee=Object(O.d)({name:"modal",initialState:{isShown:!1,modalName:null},reducers:{show:function(e,t){e.isShown=!0,e.modalName=t.payload},hide:function(){return{isShown:!1,modalName:null}}}}),te=ee.reducer,ne=ee.actions,re=ne.show,ce=ne.hide,ae="https://cyh-paint.herokuapp.com",ie=function(e,t,n){return fetch("".concat(ae,"/api/projects"),{method:"POST",headers:{Accepet:"application/json","Content-Type":"application/json"},body:JSON.stringify({name:e,strokes:t,image:n})}).then((function(e){return e.json()}))},oe=Object(O.c)("products/getProduct",function(){var e=Object(X.a)(W.a.mark((function e(t,n){var r,c;return W.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.rejectWithValue,e.prev=1,e.next=4,fetch("".concat(ae,"/api/projects/")).then((function(e){return e.json()}));case 4:return c=e.sent,e.abrupt("return",c);case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",r("error"));case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t,n){return e.apply(this,arguments)}}()),se=Object(O.d)({name:"projects",initialState:{pendding:!1,error:null,projects:[]},reducers:{},extraReducers:function(e){e.addCase(oe.fulfilled,(function(e,t){e.pendding=!1,e.projects=t.payload})),e.addCase(oe.rejected,(function(e,t){e.pendding=!1,e.error=t.payload})),e.addCase(oe.pending,(function(e,t){e.pendding=!0}))}}).reducer,ue=function(e){var t=e.top,n=e.left,r=$(),c=Object(b.b)(),a=Object(C.a)((function(){return{type:D,item:{type:D,top:t,left:n},collect:function(e){return{isDragging:e.isDragging()}}}}),[t,n]),i=Object(d.a)(a,2),o=i[0].isDragging,s=i[1],u=function(){var e=Object(X.a)(W.a.mark((function e(){var t;return W.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,H(r.current);case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return");case 5:Object(Y.saveAs)(t,"drawing.png");case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return o?Object(A.jsx)("div",{ref:s}):Object(A.jsxs)("div",{className:"window file-panel",ref:s,style:{top:t+"px",left:n+"px"},children:[Object(A.jsx)("div",{className:"title-bar",children:Object(A.jsx)("div",{className:"title-bar-text",children:"File"})}),Object(A.jsx)("div",{className:"window-body",children:Object(A.jsxs)("div",{className:"field-row",children:[Object(A.jsx)("button",{className:"button clear",onClick:u,children:"Export"}),Object(A.jsx)("button",{className:"button",onClick:function(){c(re("PROJECT_MODAL")),c(oe())},children:"Load"}),Object(A.jsx)("button",{className:"button",onClick:function(){return c(re("PROJECT_SAVE_MODAL"))},children:"Save"})]})})]})},le=n(55),de=n(30),je=n.n(de),fe=function(){var e=$(),t=Object(b.c)(R),n=Object(b.c)(L),c=Object(b.c)(M),a=!!t.points.length,i=Object(b.b)(),o=function(){a&&i(p({currentStroke:t,historyIndex:n}))},s=Object(r.useCallback)((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.current;return{canvas:t,context:null===t||void 0===t?void 0:t.getContext("2d")}}),[e]);return Object(r.useEffect)((function(){var e=s(),t=e.canvas,n=e.context;t&&n&&(!function(e,t,n){e.width=t,e.height=n}(t,960,540),n.lineJoin="round",n.lineCap="round",n.lineWidth=5,G(t,n))}),[s]),Object(r.useEffect)((function(){var e=s().context;e&&requestAnimationFrame((function(){K(e,t.points,t.color)}))}),[t,s]),Object(r.useEffect)((function(){var e=s(),t=e.canvas,r=e.context;r&&t&&requestAnimationFrame((function(){G(t,r),c.slice(0,c.length-n).forEach((function(e){K(r,e.points,e.color)}))}))}),[c,n,s]),Object(A.jsx)("canvas",{className:je.a.canvas,onMouseDown:function(e){var t=e.nativeEvent,n=t.offsetX,r=t.offsetY;i(y({x:n,y:r}))},onMouseUp:o,onMouseOut:o,onMouseMove:function(e){var t=e.nativeEvent;if(a){var n=t.offsetX,r=t.offsetY;i(w({x:n,y:r}))}},ref:e})},be=function(){var e=Object(b.c)(_),t=Object(b.b)(),n=Object(r.useRef)(null);Object(r.useEffect)((function(){var e=function(e){n.current&&!n.current.contains(e.target)&&t(ce())};return document.addEventListener("click",e),function(){document.removeEventListener("click",e)}}),[t]);return Object(A.jsx)("div",{className:"modal",children:Object(A.jsx)("div",{className:"modal-content",ref:n,children:Object(A.jsxs)("div",{className:"window",children:[Object(A.jsxs)("div",{className:"title-bar",children:[Object(A.jsx)("div",{className:"title-bar-text",children:"Counter"}),Object(A.jsx)("div",{className:"title-bar-controls",children:Object(A.jsx)("button",{"aria-label":"Close",onClick:function(){return t(ce())}})})]}),Object(A.jsx)("div",{className:"projects-container",children:e.pendding?Object(A.jsx)("div",{children:"loading..."}):e.error?Object(A.jsx)("div",{children:"error"}):e.projects.map((function(n){return Object(A.jsxs)("div",{className:"project-card",children:[Object(A.jsx)("img",{src:n.image,alt:"thumbnail",onClick:function(){return function(n){var r=e.projects.find((function(e){return e.id===n}));r&&(t(ce()),t(h(r.strokes)))}(n.id)}}),Object(A.jsx)("div",{children:n.name})]},n.id)}))})]})})})};function Oe(e){var t=e.file,n=e.scale,r=void 0===n?.1:n;return new Promise((function(e,n){var c=new FileReader;c.readAsDataURL(t),c.onload=function(t){var n,c=new Image;c.onload=function(){var t=document.createElement("canvas"),n=t.width=c.width*r,a=t.height=c.height*r,i=t.getContext("2d");if(i)return i.drawImage(c,0,0,n,a),e(t.toDataURL())},c.src=null===(n=t.target)||void 0===n?void 0:n.result},c.onerror=function(e){return n(e.toString())}}))}var pe=function(){var e=Object(r.useState)(""),t=Object(d.a)(e,2),n=t[0],c=t[1],a=Object(b.c)(M),i=Object(b.b)(),o=Object(r.useRef)(null),s=$();Object(r.useEffect)((function(){var e=function(e){o.current&&!o.current.contains(e.target)&&i(ce())};return document.addEventListener("click",e),function(){document.removeEventListener("click",e)}}),[i]);var u=function(){var e=Object(X.a)(W.a.mark((function e(){var t,r;return W.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,H(s.current);case 4:if(t=e.sent){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,Oe({file:t,scale:.2});case 9:return r=e.sent,e.prev=10,e.next=13,ie(n,a,r);case 13:e.sent.success&&i(ce()),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(10),console.log(e.t0);case 20:case"end":return e.stop()}}),e,null,[[10,17]])})));return function(){return e.apply(this,arguments)}}();return Object(A.jsx)("div",{className:"modal",children:Object(A.jsx)("div",{className:"modal-content",ref:o,children:Object(A.jsxs)("div",{className:"window",children:[Object(A.jsx)("div",{className:"title-bar",children:Object(A.jsx)("div",{className:"title-bar-text",children:"Save"})}),Object(A.jsxs)("div",{className:"window-body",children:[Object(A.jsxs)("div",{className:"field-row-stacked",children:[Object(A.jsx)("label",{htmlFor:"projectName",children:"Project name"}),Object(A.jsx)("input",{id:"projectName",type:"text",onChange:function(e){return c(e.target.value)},value:n})]}),Object(A.jsxs)("div",{className:"field-row",children:[Object(A.jsx)("button",{onClick:u,children:"Save"}),Object(A.jsx)("button",{onClick:function(){return i(ce())},children:"Cancel"})]})]})]})})})},xe=function(){switch(Object(b.c)(P).modalName){case"PROJECT_MODAL":return Object(A.jsx)(be,{});case"PROJECT_SAVE_MODAL":return Object(A.jsx)(pe,{});default:return null}},he=function(){var e=Object(r.useState)({x:30,y:200}),t=Object(d.a)(e,2),n=t[0],c=t[1],a=Object(r.useState)({x:30,y:30}),i=Object(d.a)(a,2),o=i[0],u=i[1],l=Object(r.useState)({x:30,y:120}),j=Object(d.a)(l,2),b=j[0],O=j[1],p=Object(le.a)((function(){return{accept:[S,E,D],drop:function(e,t){if(t.getDifferenceFromInitialOffset()){var n=t.getDifferenceFromInitialOffset(),r=Math.round(e.left+n.x),a=Math.round(e.top+n.y);e.type===S?c({x:r,y:a}):e.type===E?u({x:r,y:a}):e.type===D&&O({x:r,y:a})}}}})),x=Object(d.a)(p,2)[1];return Object(A.jsxs)("div",{className:s()("window-body",f.a.body),ref:x,children:[Object(A.jsx)(T,{top:n.y,left:n.x}),Object(A.jsx)(q,{top:o.y,left:o.x}),Object(A.jsx)(ue,{top:b.y,left:b.x}),Object(A.jsx)(fe,{}),Object(A.jsx)(xe,{})]})};var ve=function(){return Object(A.jsxs)("div",{className:s()("window",l.a.container),children:[Object(A.jsxs)("div",{className:"title-bar",children:[Object(A.jsx)("div",{className:"title-bar-text",children:"redux - piant"}),Object(A.jsxs)("div",{className:"title-bar-controls",children:[Object(A.jsx)("button",{"aria-label":"Minimize"}),Object(A.jsx)("button",{"aria-label":"Maximize"}),Object(A.jsx)("button",{"aria-label":"Close"})]})]}),Object(A.jsx)(he,{})]})},me=n(31),ge=[],ye={currentStroke:k,historyIndex:B,strokes:Object(O.d)({name:"strokes",initialState:ge,reducers:{},extraReducers:function(e){e.addCase(p,(function(e,t){0!==t.payload.historyIndex?e.splice(-t.payload.historyIndex,t.payload.historyIndex,t.payload.currentStroke):e.push(t.payload.currentStroke)})),e.addCase(x,(function(){return ge})),e.addCase(h,(function(e,t){return t.payload}))}}).reducer,modalVisible:te,projects:se},we=Object(O.a)({reducer:ye,middleware:function(e){return e().concat(me.logger)},devTools:!1}),Ne=n(53),ke=n(32);i.a.render(Object(A.jsx)(c.a.StrictMode,{children:Object(A.jsx)(b.a,{store:we,children:Object(A.jsx)(Ne.a,{backend:ke.a,children:Object(A.jsx)(Z,{children:Object(A.jsx)(ve,{})})})})}),document.getElementById("root"))}},[[48,1,2]]]);
//# sourceMappingURL=main.a48a944d.chunk.js.map